<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Markdown Live Preview</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
  --bg:#1e1e1e; --fg:#d4d4d4; --accent:#58a6ff; --border:#444; --line:#2b2b2b;
  --font:14px/1.5 ui-monospace, "Cascadia Code", Consolas, monospace;
}
[data-theme="light"]{
  --bg:#fdfdfd; --fg:#111; --accent:#007acc; --border:#ddd; --line:#eee;
}
*{box-sizing:border-box;font-family:var(--font);}
body{margin:0;height:100vh;display:flex;flex-direction:column;background:var(--bg);color:var(--fg);}
.toolbar{height:36px;background:var(--border);display:flex;align-items:center;padding:0 .5rem;gap:.5rem;flex-shrink:0;}
.toolbar button{padding:.25rem .5rem;border:1px solid var(--border);background:var(--bg);color:var(--fg);cursor:pointer;border-radius:4px;font-size:12px;}
.toolbar button:hover{background:var(--accent);color:#fff;}
#status{margin-left:auto;font-size:11px;color:#888;}
/* desktop split */
.main{flex:1;display:flex;overflow:hidden;}
.pane{position:relative;height:100%;overflow:hidden;}
#leftPane{width:50%;}
#rightPane{flex:1;}
#slider{width:6px;background:var(--border);cursor:col-resize;flex-shrink:0;}
h3{margin:0;padding:.4rem .6rem;font-size:12px;font-weight:600;background:var(--border);}
#editorWrap{height:calc(100% - 21px);position:relative;}
#lineNumbers{position:absolute;left:0;top:0;bottom:0;width:40px;background:var(--line);color:#888;text-align:right;padding:8px 4px;font-size:14px;line-height:21px;overflow:hidden;user-select:none;}
#md{position:absolute;left:40px;right:0;top:0;bottom:0;padding:8px;border:none;outline:none;resize:none;background:var(--bg);color:var(--fg);white-space:pre-wrap;overflow-y:scroll;}
#preview{height:calc(100% - 21px);padding:8px;overflow:auto;}
/* mobile tabs */
#tabBar{display:none;height:36px;background:var(--border);border-bottom:1px solid var(--border);}
#tabBar button{flex:1;border:none;background:transparent;color:var(--fg);cursor:pointer;font-size:12px;}
#tabBar button.active{background:var(--accent);color:#fff;}
#mobilePane{flex:1;display:none;flex-direction:column;}
#mobileEditor, #mobilePreview{
  flex:1;
  display:none;
  height:calc(100% - 36px - 36px); /* toolbar + tab-bar */
}
#mobileEditor.show, #mobilePreview.show{display:flex;flex-direction:column;}
#mobileMd{width:100%;height:100%;border:none;outline:none;resize:none;background:var(--bg);color:var(--fg);padding:8px;line-height:21px;white-space:pre-wrap;overflow-y:scroll;}
#mobilePreview{height:100%;padding:8px;overflow:auto;}
/* markdown extras */
code{background:#8882;color:var(--accent);padding:.15rem .25rem;border-radius:4px;}
pre{background:#8882;padding:.6rem;border-radius:6px;overflow-x:auto;}
blockquote{border-left:4px solid var(--accent);margin:0 0 1rem;padding-left:.6rem;color:#888;}
table{border-collapse:collapse;width:100%;}
th,td{border:1px solid var(--border);padding:.4rem;text-align:left;}
th{background:#8881;}
a{color:var(--accent);}
footer{position:absolute;bottom:4px;right:8px;font-size:11px;color:#656d76;}
/* responsive */
@media (max-width:768px){
  #slider,.main,#leftPane,#rightPane,#editorWrap,#preview{display:none;}
  #tabBar,#mobilePane{display:flex;}
}
</style>
</head>
<body data-theme="dark">
<div class="toolbar">
  <button id="btnSync" class="on">Sync</button>
  <button id="btnTheme">ðŸŒ“</button>
  <button id="btnExport">Export HTML</button>
  <span id="status">0 w 0 c</span>
  <a href="https://github.com/amitkadam96k" target="_blank" rel="noopener" style="margin-left:.4rem;">
    <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
  </a>
</div>

<!-- mobile tabs -->
<div id="tabBar">
  <button id="tabEdit" class="active">Markdown</button>
  <button id="tabPrev">Preview</button>
</div>

<!-- desktop split -->
<div class="main">
  <div id="leftPane" class="pane">
    <h3>Markdown</h3>
    <div id="editorWrap">
      <div id="lineNumbers"></div>
      <textarea id="md" spellcheck="false" autofocus></textarea>
    </div>
  </div>
  <div id="slider"></div>
  <div id="rightPane" class="pane">
    <h3>Preview</h3>
    <div id="preview"></div>
  </div>
</div>

<!-- mobile panes -->
<div id="mobilePane">
  <div id="mobileEditor" class="show">
    <textarea id="mobileMd" spellcheck="false"></textarea>
  </div>
  <div id="mobilePreview"></div>
</div>

<footer class="fixed-footer">
    Created by Amit Kadam â€“ free to use
</footer>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
<script>
/* ---------- dom ---------- */
const md        = document.getElementById('md');
const preview   = document.getElementById('preview');
const mobileMd  = document.getElementById('mobileMd');
const mobilePrev= document.getElementById('mobilePreview');
const tabEdit   = document.getElementById('tabEdit');
const tabPrev   = document.getElementById('tabPrev');
const lineNums  = document.getElementById('lineNumbers');
const btnSync   = document.getElementById('btnSync');
const btnTheme  = document.getElementById('btnTheme');
const btnExport = document.getElementById('btnExport');
const status    = document.getElementById('status');
const leftPane  = document.getElementById('leftPane');
const slider    = document.getElementById('slider');
const isMobile  = () => innerWidth <= 768;

/* ---------- theme ---------- */
function applyTheme(t){
  document.body.dataset.theme = t;
  localStorage.setItem('theme', t);
}
let currentTheme = localStorage.getItem('theme') || 'dark';
applyTheme(currentTheme);
btnTheme.onclick = () => {
  const next = document.body.dataset.theme === 'dark' ? 'light' : 'dark';
  applyTheme(next);
};

/* ---------- sync ---------- */
let syncEnabled = localStorage.getItem('sync') !== 'false';
function syncScroll(a,b){
  const ratio = a.scrollTop / (a.scrollHeight - a.clientHeight);
  b.scrollTop = ratio * (b.scrollHeight - b.clientHeight);
}
md.onscroll   = () => { if (!isMobile() && syncEnabled) syncScroll(md, preview); };
preview.onscroll = () => { if (!isMobile() && syncEnabled) syncScroll(preview, md); };
btnSync.onclick = () => {
  syncEnabled = !syncEnabled;
  localStorage.setItem('sync', syncEnabled);
  btnSync.classList.toggle('on', syncEnabled);
};
btnSync.classList.toggle('on', syncEnabled);

/* ---------- line numbers ---------- */
function refreshLineNumbers(){
  const lines = (isMobile() ? mobileMd.value : md.value).split('\n').length;
  lineNums.innerHTML = Array.from({length:lines},(_,i)=>i+1).join('<br>');
}

/* ---------- counter ---------- */
function updateCounter(){
  const txt = isMobile() ? mobileMd.value : md.value;
  const w = txt.trim() ? txt.trim().split(/\s+/).length : 0;
  status.textContent = `${w}w ${txt.length}c`;
}

/* ---------- render ---------- */
function render(){
  const src = isMobile() ? mobileMd.value : md.value;
  const html = DOMPurify.sanitize(marked.parse(src));
  if (isMobile()) mobilePrev.innerHTML = html;
  else preview.innerHTML = html;
  updateCounter();
}

/* ---------- mobile tabs ---------- */
tabEdit.onclick = () => {
  tabEdit.classList.add('active');
  tabPrev.classList.remove('active');
  mobileMd.parentElement.classList.add('show');
  mobilePrev.classList.remove('show');
};
tabPrev.onclick = () => {
  tabPrev.classList.add('active');
  tabEdit.classList.remove('active');
  mobilePrev.classList.add('show');
  mobileMd.parentElement.classList.remove('show');
};

/* ---------- auto-save ---------- */
let saveTimer;
function handleInput(){
  refreshLineNumbers();
  render();
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => {
    const val = isMobile() ? mobileMd.value : md.value;
    localStorage.setItem('md_content', val);
  }, 400);
}
md.oninput = handleInput;
mobileMd.oninput = handleInput;

/* ---------- export ---------- */
btnExport.onclick = () => {
  const src = isMobile() ? mobileMd.value : md.value;
  const html = `<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Export</title>
<style>body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;max-width:800px;margin:2rem auto;line-height:1.6;}
code{background:#f3f4f6;padding:.15rem .3rem;border-radius:4px;}
pre{background:#f3f4f6;padding:1rem;border-radius:6px;overflow-x:auto;}
blockquote{border-left:4px solid #0366d6;margin:0 0 1rem;padding-left:1rem;color:#555;}
table{border-collapse:collapse;width:100%;}th,td{border:1px solid #d0d7de;padding:.4rem .6rem;text-align:left;}th{background:#f6f8fa;}
a{color:#0366d6;}</style></head><body>${marked.parse(src)}</body></html>`;
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([html], {type:'text/html'}));
  a.download = 'markdown-export.html';
  a.click();
};

/* ---------- desktop slider ---------- */
let dragging = false;
slider.onmousedown = e => {
  dragging = true;
  document.body.style.cursor = 'col-resize';
  e.preventDefault();
};
window.onmousemove = e => {
  if (!dragging || isMobile()) return;
  leftPane.style.width = e.clientX + 'px';
};
window.onmouseup = () => {
  dragging = false;
  document.body.style.cursor = '';
};

/* ---------- init ---------- */
const saved = localStorage.getItem('md_content') || '';
md.value = saved;
mobileMd.value = saved;
refreshLineNumbers();
render();
</script>
</body>
</html>

